# МЗВП "Московский завод по вылову шпинов для нужд малой и средней оборонной промышленнсотей"

## Последовательность запуска внутренних механизмов завода

Необходим python3.13 (я полагаю, хотя можете и на более ранних попробовать)

Первоначальная настройка проекта:
```
python3 -m venv venv               # создали окрежение
source venv/bin/activate           # подключили окружение (linux или powershell)
# .\venv\scripts\activate.bat      # то же самое, но если в CMD
pip install -r requirements.txt    # установили библиотеки
cp .env_example .env               # создали файл конфигурации
```

После этого берёте свой любимый текстовый редактор и заполняете переменные в
.env своими секретными значениями для подключения к базе

Для запуска бекенда: `python backend.py`. Убедитесь перед запуском, что вы вошли
в окружение.

Запустится сервер, который будет слушать соединения на `localhost:8000`
(на винде бывает, что имя localhost не распознаётся, так что, альтернатива:
`127.0.0.1:8000`).

## Реализованные методы:

### /api/v1/update_users:

Принимает на вход csv файл, с уникальными пользовательскими данными. Данные
из файла будут синхронизированы с данными в базе. При наличии несостыковок между
исходными данными и присланными, конфликтующие записи не удалятся и с ответе
в поле `"problems"` вернётся массив номеров паспорта, для каторый данные
не стыкуются с имеющимися. Отсутсвие информации не расценивается как несостыковка.

пример отправки запроса:

```
from scripts.request_util import *

SERVICE_URL="http://localhost:8000"
with open("data/tempfiles/usr1.csv", "rb") as f:
    print(upload_file("/api/v1/update_users", base_url=SERVICE_URL, data={}, file=f))
```

Определение функции `upload_file` см. в `./scripts` 

Файл дожлен содержать колонки:
* `doc_num` -- строка (до 16 символов) -- номер паспорта (уникальный в рамках файла)
* `first_name`, `last_name` -- имя и фамилия (непустые)
* `second_name`  -- отчество (полное)
* `second_name1` -- отчество (сокращённое)
* `birth_date` -- дата рождения в ISO формате (гггг-мм-дд)
* `is_man` -- пол мужской => True иначе False (или пропуск)
